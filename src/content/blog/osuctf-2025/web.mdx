---
title: 'Web'
description: "I participated a CTF for the first time. It was fun."
date: 2025-05-30
tags: ['ctf', 'writeup', 'web']
image: './banner.png'
authors: ['rin']
---

import Chall from "@/components/posts/Chall.astro"

# Preliminary
Now, this is the *best* category of this contest. Might be because there are multiple `web` challenge authors, might be because it's accessible to many people, might be because it's the nicest category to solve out there without feeling we lack knowledge since web knowledges are easily accessible, might be all of these.

Initially I had a friend who wanted to join me on `web`, but they forgot to ask and I also didn't want to ask, so I ended up doing the `crypto` ones on Saturday then dip. Revisiting, yeah, I should turn my focus to this next year.

When I say fun it doesn't mean the `web` challenges are free, though. There are two quite impossible challenges that somebody has a wonderful, wonderful write-up for, I'll link to theirs instead of writing my own.

The `web` category has one more very interesting constraint that I'll put in the challenge description boxes. Basically, some of these challenges are hosted in a thing called ***instancers*** ([find the instancer source code here](https://github.com/es3n1n/tiny-instancer)), which when you request an instance of the challenge, it spawns one hosted instance of that challenge, each of that instance lasts for around 15 minutes.

Good luck with that instancer if you feel hosting the thing yourself is a hassle.

# The Challenges
## web/admin-panel

<Chall
  title="Admin Panel"
  authors={["strellic"]}
  category="web"
  solvedInTime="no"
  files={["web_admin-panel.tar.gz"]}
  flag="osu{php_is_too_3asy}"
  instancer="15 minutes"
>
  we found the secret osu! admin panel!!

  can you find a way to log in and read the flag?
</Chall>

We're presented with this login window upon opening an instance.

![Login window](./assets/web/admin-panel/1.png)

Well, we don't have credentials for sure. Let's check the source, surely the passwor-
```php title="login.php" startLineNumber=3
$admin_password = bin2hex(random_bytes(16));
```

The password is literally random every login. Alright, so that's not an option, now how about the way the password is checked then? That's the second step, surely something hits.
```php title="login.php" startLineNumber=9
if ($username == "peppy" && strcmp($admin_password, $password) == 0) {
  $_SESSION["logged_in"] = true;
  header("Location: admin.php");
  exit();
}
```

A tiny amount of Googling later and you'll find [this vulnerability](https://www.php.net/manual/en/function.strcmp.php#121789) with using `strcmp(){:php}` like this in `PHP`, which allows you to type juggle and get in without ever touching entropy itself. To explain what would happen if we throw an array in `strcmp(){:php}` to compare against a string, we get `NULL`, and `NULL == 0` is `true`.

Simple `DevTools` does the job well.

![DevTools](./assets/web/admin-panel/2.png)

I wonder why does the world keep using `PHP` if things like this has existed for 8 years and never got patched?

Anyway, now we can navigate to the admin panel. We're presented with this window:

![Admin panel](./assets/web/admin-panel/3.png)

So looks like the second layer of this challenge is some sort of RCE. Check the source code again to see the upload logic, we can see a fatal flaw:
```php title="admin.php" startLineNumber=8
if ($_SERVER["REQUEST_METHOD"] == "POST") {
  if (isset($_FILES["file"])) {
    $file = $_FILES["file"];
    $filename = $file["name"];
    $contents = file_get_contents($file["tmp_name"]);

    if (stripos($filename, ".php") !== false) {
      echo "<h1>file is not allowed</h1>";
    }
    else if (stripos($contents, "<?php") !== false) {
      echo "<h1>file has unsafe contents</h1>";
    }
    else {
      move_uploaded_file($file["tmp_name"], "./uploads/" . $filename);
      header("Location: /uploads/" . $filename);
    }
    die();
  }
}
```

It checks if our file ends with `.php`, if not, it checks if it contains a `php` snippet. Well, we can just upload other things that's both not a `.php` file and doesn't contain a `php` snippet.

One more thing, this server uses an *Apache HTTP server* as denoted in the Dockerfile. We can use a `.htaccess` file to manage access rules and such, that's searchable on Google as well really quickly. So, just make a little `.htaccess` file like this, then throw that on the server:
```txt
AddType application/x-httpd-php .trolshrug
```

That makes any file with the extension `.trolshrug` gets parsed as a `PHP` file, which obviously is both destructive, and disrespectful. Ignore whatever error appeared after uploading that `.htaccess` file, it doesn't matter and you can simply get back to the admin page.

Now, in a file `haha.trolshrug`,
```php title="haha.trolshrug"
<? system("cat /flag.txt"); ?>
```

This reads the flag and serves it as is. Upon uploading that, what we see is this blank page with just the flag's content:

![Flag](./assets/web/admin-panel/4.png)

The challenge is solved.


